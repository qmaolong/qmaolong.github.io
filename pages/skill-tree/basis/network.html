<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="keywords" content="邱茂龙,茂龙,博客,邱茂龙的博客,Nick61ba,你可拉倒吧,Nick61ba的博客,Nick61ba's blog,qiumaolong,qmaolong,qmaolong.cn,IT,Java,福建厦门,程序员"><meta name="description" content="颜值不及格，打架没赢过；IT庸才，没意见领袖。总之，谢谢你来看我。"><title>【计算机网络】TCP/IP原理 | Nick61ba's</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '4f7c44a604857f973b5652d06040cda7';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【计算机网络】TCP/IP原理</h1><a id="logo" href="/.">Nick61ba's</a><p class="description">记录本身 即已是反抗</p></div><div id="nav-menu"><a href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【计算机网络】TCP/IP原理</h1><div class="post-content"><h3 id="TCP段格式"><a href="#TCP段格式" class="headerlink" title="TCP段格式"></a>TCP段格式</h3><p><img src="image/tcp.png" alt="TCP段格式"></p>
<p>1．源端口（Source Port）和目的端口（Destination Port）<br>2．序列号（Sequence Number）：定义数据段中的数据部分在发送方数据流中的位置<br>3．确认号（Acknowledgment Number）：定义报文段的接收方期望从对方接收的序列号<br>4．首部长度（Header length）：以字节为单位表示TCP首部的大小，这个字段的值可以在5（5×4=20）至15（1×4=60）之间，即首部长度可以在20～60字节之间<br>5．标志（Flags）：定义6种不同的控制位或标志位，这些标志位用在TCP的流量控制、连接建立和终止以及数据传送方式等方面<br>6．窗口大小（Window size）：指明TCP接收方缓冲区的长度<br>7．校验和（Checksum）：校验和用于传输层差错检测，允许目的主机可以验证TCP段的内容并能够测试可能的破坏<br>8．紧急指针（Urgent Pointer）：只有当紧急标志置位（值为1）时，这个字段才有效，这时的报文段中包括紧急数据；如果URG指针被设置，接收方必须检查这个字段；紧急指针所指向的一段数据不必等待缓冲数据的积累，直接发送到对方<br>9．选项（Options）：</p>
<h3 id="TCP可靠性————差错控制"><a href="#TCP可靠性————差错控制" class="headerlink" title="TCP可靠性————差错控制"></a>TCP可靠性————差错控制</h3><p>TCP的差错控制包括检测损坏的报文段、丢失的报文段、失序的报文段和重复的报文段，并进行纠正。应用程序将数据流交付给TCP后，就依靠TCP将整个数据流按序且没有损坏、没有部分丢失、没有重复地交付给另一端的应用程序。TCP中的差错检测和差错纠正的方法有校验和、确认和重传。</p>
<p><strong>校验和</strong> 每一个报文段都包括校验和字段，用来检查受损的报文段。<br><strong>确认</strong> TCP采用确认来证实收到了报文段，控制报文段不携带数据，但消耗一个序列号。控制报文段也需要被确认。只有ACK报文段永远不需要被确认。<br><strong>重传</strong> 差错控制机制的核心就是报文段的重传。当一个报文段损坏、丢失或者被延迟了，就要重传。目前的TCP实现中，有以下两种报文段重传机制。</p>
<ul>
<li>超时重传</li>
<li>快重传</li>
</ul>
<p><strong>失序报文段的处置</strong> 当一个报文段推迟到达、丢失或被丢弃，在这个报文段后面的几个报文段就是失序到达。现在大多数的实现是不丢弃这些失序的报文段，而是把这些报文段暂时存储下来，并把它们标志为失序报文段，直到丢失的报文段到达。<br><strong>重复报文段的处置</strong> 重复的报文段一般是由超时重传造成的，接收方可以根据序列号判断是否是重复报文段，对于重复报文段只需要简单丢弃即可。<br><strong>选择确认（SACK）</strong> 现在一些新的TCP实现中支持选择确认（SACK），报告失序和重复的报文段，将其作为TCP首部选项字段的一部分。</p>
<h3 id="TCP可靠性————流量控制"><a href="#TCP可靠性————流量控制" class="headerlink" title="TCP可靠性————流量控制"></a>TCP可靠性————流量控制</h3><p>TCP在传输层上实现端到端的流量控制，为接收方对发送方发送数据进行控制，以避免大量的数据导致接收方瘫痪，这是通过滑动窗口机制来实现的。</p>
<p><img src="image/huadongchuangkou.png" alt="滑动窗口机制"></p>
<h4 id="1．滑动窗口机制"><a href="#1．滑动窗口机制" class="headerlink" title="1．滑动窗口机制"></a>1．滑动窗口机制</h4><p>发送方与接收方各自维护一个缓冲区，在缓冲区（暂时存放从应用程字传出并准备发送的数据）上使用滑动窗口，接收方将当前窗口大小通告给发送方（利用TCP报文段首部的窗口大小字段），发送方根据接收窗口调整其发送窗口，使发送窗口始终小于或等于接收窗口的大小。只有在接收窗口滑动时（与此同时也发送了确认），发送窗口才有可能滑动。收发双方的窗口按照以上规律不断地向前滑动，因此这种协议又称为<strong>滑动窗口协议</strong>。</p>
<p>当发送窗口和接收窗口的大小都等于1时，每发送一个字节的数据都要等待对方的确认，这就是<strong>停止等待协议</strong>。当发送窗口大于1，接收窗口等于1时，就是<strong>回退N步协议</strong>。当发送窗口和接收窗口的大小均大于1时，就是<strong>选择重发协议</strong>。协议中规定窗口内未经确认的分组需要重发。这种分组的数量最多可以等于发送窗口的大小，即滑动窗口的大小n减去1（因为发送窗口不可能大于（n-1），起码接收窗口要大于等于1）。</p>
<p>TCP的窗口以字节为单位进行调整，以适应接收方的处理能力。处理过程如下。</p>
<ul>
<li>（1）TCP连接阶段，双方协商窗口大小，同时接收方预留数据缓存区；</li>
<li>（2）发送方根据协商的结果，发送符合窗口大小的数据字节流，并等待对方的确认；</li>
<li>（3）发送方根据确认信息，改变窗口大小，增加或者减少发送未得到确认的字节流中的字节数。如果出现发送拥塞，发送窗口缩小为原来的一半，同时将超时重传的时间间隔扩大一倍。</li>
</ul>
<h4 id="2．发送方产生的糊涂窗口综合症"><a href="#2．发送方产生的糊涂窗口综合症" class="headerlink" title="2．发送方产生的糊涂窗口综合症"></a>2．发送方产生的糊涂窗口综合症</h4><p>如果发送方TCP为生产数据很慢的应用程序服务，就可能产生糊涂窗口综合症。解决的方法是防止发送方TCP逐个字节地发送数据，强迫发送方TCP等待，凑成大块数据再发送。为了使TCP等待的时间更为合理，采用了Nagle算法，如果应用程序比网络更快，则报文段就较大（最大长度报文段）。若应用程序比网络慢，则报文段就较小（小于最大长度报文段）。</p>
<h4 id="3．接收方产生的糊涂窗口综合症"><a href="#3．接收方产生的糊涂窗口综合症" class="headerlink" title="3．接收方产生的糊涂窗口综合症"></a>3．接收方产生的糊涂窗口综合症</h4><p>如果接收方TCP为消耗数据很慢的应用程序服务，就可能产生糊涂窗口综合症。当接收缓冲区已满，通知窗口大小为0，发送方必须停止发送数据。</p>
<p>针对这种情形，有两种解决方法。</p>
<ul>
<li>（1）延迟通告（Delayed Advertisement）</li>
</ul>
<p>延迟通告又称Clark法，只要有数据到达就发送确认，但在缓冲区已有足够大的空间放入最大长度报文段（Maximum Sized Segment, MSS）之前，或者缓冲区空闲空间达到一半之前，一直都宣布窗口值为0。</p>
<ul>
<li>（2）推迟确认（Delayed Acknowledgement）</li>
</ul>
<p>当报文段到达时并不立即发送确认。接收方在对收到的报文段进行确认之前一直等待，直到输入缓冲区有足够的空间为止。推迟发送确认防止了发送方TCP滑动它的窗口。当发送端TCP发送完数据后就停下来了。推迟确认还有另一个优点，就是减少了通信量，不需要对每一个报文段进行确认。不过推迟确认有可能迫使发送方重传它未被确认的报文段，为此推迟确认设置不能超过500ms。</p>
<h5 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h5><p>滑动窗口机制为端到端设备间的数据传输提供了可靠的流量控制机制。然而，它只能在源端设备和目的端设备起作用，当网络中间设备（如路由器等）发生拥塞时，滑动窗口机制将不起作用。</p>
<h3 id="TCP可靠性————拥塞控制"><a href="#TCP可靠性————拥塞控制" class="headerlink" title="TCP可靠性————拥塞控制"></a>TCP可靠性————拥塞控制</h3><p>流量控制是由于接收方不能及时处理数据而引发的控制机制，<strong>拥塞</strong>（Congestion，又译为阻塞）是由于网络中的路由器超载而引起的严重延迟现象。</p>
</div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="search"><input type="hidden" name="si" value="qmaolong.cn"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/书影音/">书影音</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/书籍/">书籍</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/抄书/">抄书</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂文/">杂文</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/语录/">语录</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-flag-o"> 标签</i></div><div class="tagcloud"><a href="/tags/调音师/" style="font-size: 15px;">调音师</a> <a href="/tags/影评/" style="font-size: 15px;">影评</a> <a href="/tags/区块链/" style="font-size: 15px;">区块链</a> <a href="/tags/精进/" style="font-size: 15px;">精进</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/JAVA/" style="font-size: 15px;">JAVA</a> <a href="/tags/图像处理/" style="font-size: 15px;">图像处理</a> <a href="/tags/鲁迅/" style="font-size: 15px;">鲁迅</a> <a href="/tags/随想/" style="font-size: 15px;">随想</a> <a href="/tags/语录/" style="font-size: 15px;">语录</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-calendar-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/1120-语录201120/">语录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/0302-推荐——《精进：如何成为一个很厉害的人》/">推荐——《精进：如何成为一个很厉害的人》</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/0224-区块链概览/">区块链概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/0526-用JAVA截取图片并矫正的算法/">一种用Java截取图片并矫正的算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/0523-《调音师》-只有兔子的故事是捏造的吗？/">《调音师》——只有兔子的故事是捏造的吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/0509-一件小事/">一件小事</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/0424-社戏/">社戏（抄书）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/0424-祝福/">祝福（抄书）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.mythsman.com/archives/" title="Myths" target="_blank">Myths</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ivy-end.com/" title="Ivy-End" target="_blank">Ivy-End</a><ul></ul><a href="https://xuquan.site/archives/" title="Nikkkki's Notes" target="_blank">Nikkkki's Notes</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Nick61ba's.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho. </a><a rel="nofollow" target="_blank" href="http://beian.miit.gov.cn">闽ICP备19021748号-1</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script>var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>